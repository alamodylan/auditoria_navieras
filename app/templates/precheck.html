{% extends "base.html" %}
{% block title %}Validación - Auditoría{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body p-4">

        <h1 class="h4 mb-2">Archivos cargados</h1>
        <p class="text-muted mb-4">
          Revisamos que los archivos se puedan leer y que el formato sea válido.
        </p>

        {% if report.ok %}
          <div class="alert alert-success">
            Validación OK. Puede generar el reporte.
          </div>

          <form method="post" action="{{ url_for('web.run_job_route', job_id=job_id) }}">
            <button class="btn btn-primary btn-lg w-100" type="submit">
              Generar reporte
            </button>
          </form>

          <div class="mt-3 text-muted small">
            Si algo sale mal, el sistema mostrará un mensaje claro y podrás reintentar.
          </div>

        {% else %}
          <div class="alert alert-danger">
            No se pudo validar los archivos.
            <div class="mt-2"><strong>Motivo:</strong> {{ report.message }}</div>
          </div>

          <a class="btn btn-outline-primary w-100" href="{{ url_for('web.upload') }}">
            Volver a subir archivos
          </a>

          <details class="mt-3">
            <summary class="text-muted small">Ver detalle técnico</summary>
            <pre class="small bg-light p-2 border rounded mt-2">{{ report | tojson(indent=2) }}</pre>
          </details>
        {% endif %}

      </div>
    </div>
  </div>
</div>
{% endblock %}